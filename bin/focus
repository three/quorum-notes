#!/usr/bin/env zsh
set -eu -o pipefail

XDG_STATE_HOME="${XDG_STATE_HOME:-$HOME/.local/state}"
CONFIG_DIR="$XDG_STATE_HOME/focus"
mkdir -p "$CONFIG_DIR"

if [[ $# -eq 0 ]]; then
    if [[ -f "$CONFIG_DIR/task" ]]; then
        cat "$CONFIG_DIR/task"
        date -r "$CONFIG_DIR/start"
    else
        echo "No task selected"
    fi
    exit 0
fi

if [[ $1 = on ]]; then
    echo $2 >"$CONFIG_DIR/task"
    date +%s >"$CONFIG_DIR/start"
fi

if [[ $1 = stop ]]; then
    if [[ -f "$CONFIG_DIR/task" ]]; then
        rm "$CONFIG_DIR/task"
    else
        echo "No task selected"
    fi
fi
